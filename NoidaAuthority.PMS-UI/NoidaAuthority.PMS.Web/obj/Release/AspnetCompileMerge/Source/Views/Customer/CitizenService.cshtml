@*@model NoidaAuthority.PMS.Web.Models.PropertyDetail*@
@model NoidaAuthority.PMS.Entity.CitizenServiceRequest
@using Kendo.Mvc.UI;
@using NoidaAuthority.PMS.Entities;
@using NoidaAuthority.PMS.Entity;
@using NoidaAuthority.PMS.Common;
@{
    ViewBag.Title = "Citizen Service";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}
<style>
    .k-picker-wrap.k-state-default {
        border-radius: 0;
    }

    .k-dropdown {
        border-radius: 0;
    }

    .k-dropdown-wrap.k-state-default {
        border-radius: 0;
    }
</style>

@*<link href="@Url.Content("~/Content/kendo/2014.2.716/kendo.common.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/kendo/2014.2.716/kendo.default.min.css")" rel="stylesheet" />
    <script src="~/Scripts/kendo/2014.2.716/kendo.web.min.js"></script>
    <script src="~/Scripts/jquery.ba-hashchange.js"></script>*@

@using (Html.BeginForm("UploadFiles", "Customer", FormMethod.Post, new { id = "userform", name = "userform", enctype = "multipart/form-data" }))
{
    @Html.HiddenFor(m => m.ServiceRequestId);
    @Html.HiddenFor(m => m.Registration_No);
    @Html.HiddenFor(m => m.ServiceId);

    <div class="row" id="PropertyDetailContainerDiv" data-registrationid="@Model.Registration_No">
        @*<div class="row" id="PropertyDetailContainerDiv">*@
        <div class="col-md-12">
            <div class="row" style="padding: 0 10px 20px;">
                <div class="col-md-12 divPropertyDetailHeader">
                    <h4 class="inline">Citizen Services Request</h4>
                    <span class="pull-right RID-txt">(Registration No: @Model.Registration_No)</span>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 leftDiv">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="nw-lbl-lft">Request Id:</label>
                        </div>
                        <div class="col-md-3">
                            <label class="nw-lbl-rht">@Model.ServiceRequestId</label>
                        </div>
                        <div class="col-md-3"><label class="nw-lbl-lft">Service Name:</label></div>
                        <div class="col-md-3"><label class="nw-lbl-rht">@Model.ServiceName</label></div>
                    </div>
                    @*<div class="row">
                            <div class="col-md-3">
                                <label class="nw-lbl-lft">Name:</label>
                            </div>
                            <div class="col-md-3">
                                <label class="nw-lbl-rht">@Model.Name</label>
                            </div>
                            <div class="col-md-3"><label class="nw-lbl-lft">Property Number:</label></div>
                            <div class="col-md-3"><label class="nw-lbl-rht">@Model.Property_No</label></div>
                        </div>*@

                    @if (Model.ServiceId == Contants.trans)
                    {
                        <div class="row" style="padding: 30px 0 20px;">
                            <div class="col-md-12 divPartialViews no-padding">
                                @{ Html.RenderPartial("_TransferRequest", Model.transDetails); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (@Model.ServiceId == Contants.MortgageID)
                    {
                        <div class="row" style="padding: 30px 0 20px;">
                            <div class="col-md-12 divPartialViews no-padding">

                                @{ Html.RenderPartial("_CitizenMortgage", Model.MortgageDetails); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (@Model.ServiceId == Contants.mutation)
                    {
                        <div class="row" style="padding: 30px 0 20px;">
                            <div class="col-md-12 divPartialViews no-padding">

                                @{ Html.RenderPartial("_MutationRequest", Model.mutationDetails); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (@Model.ServiceId == Contants.CICD)
                    {
                        <div class="row">
                            <div class="col-md-12 no-padding">

                                @{ Html.RenderPartial("_CitizenCIC", Model.CICmodel); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (Model.ServiceId == Contants.GPAModel)
                    {
                        <div class="row">
                            <div class="col-md-12 no-padding">

                                @{ Html.RenderPartial("_CitizenGPAForm", Model.gdaModel); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (Model.ServiceId == RentService.ServiceType1)
                    {
                        <div class="row" style="">
                            <div class="col-md-12 no-padding">
                                @{ Html.RenderPartial("_RentService", Model.RentingModel); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @if (Model.ServiceId == Contants.ExtensionServiceRequest)
                    {
                        <div class="row" style="">
                            <div class="col-md-12 no-padding">
                                @{ Html.RenderPartial("_ExtensionRequest", Model.ExtensionRequest); }
                                @*@{ Html.RenderPartial("_OthersRequest", Model.otherReq); }*@
                            </div>
                        </div>
                    }
                    @*@if (Model.ServiceId > 9 || Model.ServiceId == 5)
                    {
                        <div class="row" style="">
                            <div class="col-md-12 no-padding">
                                @{ Html.RenderPartial("_OthersRequest", Model.otherReq); }
                            </div>
                        </div>
                    }*@
                    
                    <div class="row" style="">
                        <div class="col-md-12 no-padding">
                            @{ Html.RenderPartial("_OthersRequest", Model.otherReq); }
                        </div>
                    </div>
                </div>

            </div>
            <div class="row" style="padding: 0 10px 20px;">
                @if (ViewBag.uploadhtml != string.Empty)
                {
                    <div class="col-md-12 nw-upload-wrap UploadDocuments">
                        <div class="row" style="padding: 0 10px;">
                            @*<div class="col-md-12 divPropertyDetailHeader">
                                    <h4 class="inline">Upload Documents</h4>
                                </div>*@
                        </div>
                        <p style="padding:10px 10px 20px; color:#000">Please attach relevant documents for required Services. All documents are mandatory. If attached documents are not relevant, your service request will be rejected. </p>
                        <div class="row">
                            <div class="col-md-12">

                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div id="single">
                            <div class="grid-service-tbl">
                                <div class="gServiceTableRow">
                                    <div class="gServiceTableHead"><strong>Serial #</strong></div>
                                    <div class="gServiceTableHead"><strong>ID</strong></div>
                                    <div class="gServiceTableHead"><strong>Choose File</strong></div>

                                </div>
                                @Html.Raw(ViewBag.uploadhtml)
                            </div>

                        </div>
                    </div>
                }
            </div>
            <div class="row" style="padding: 0 10px 20px;">
                @{
    if (Model.ServiceId == RentService.ServiceType1)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnRentServiceSubmit" class="btn btn-upload-doc btnName btnRequestFormSubmit" style="padding:10px 20px" value="Submit" />
            @*<input type="button" class="btn btn-upload-doc btnName btnRequestFormSubmit" style="padding:10px 20px" value="Submit" />*@
        </div>
    }
    if (Model.ServiceId == Contants.trans)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnTransferServiceSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId == Contants.MortgageID)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnMortgageServiceSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId == Contants.mutation)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnMutationServiceSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId == Contants.CICD)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnCICDServiceSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId == Contants.GPAModel)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnGPAServiceSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId == Contants.ExtensionServiceRequest)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnExtensionRequestSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
    if (Model.ServiceId > 9 || Model.ServiceId == 5)
    {
        <div class="col-md-12" style="text-align:right;">
            <input type="button" id="btnOthersRequestSubmit" class="btn btn-upload-doc btnName" style="padding:10px 20px" value="Submit" />
        </div>
    }
                }

            </div>

        </div>
    </div>


}


<div id="divAcknowledgementModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="padding-top:40px;" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" style="width: 60%">
        <div class="modal-content">
            <div class="modal-header">
                @*<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>*@
                <h4 class="modal-title">  <b>Service Request Acknowledgement</b></h4>
            </div>
            <div class="modal-body" id="divAcknowledgementReceiptBody" style="overflow:auto;height:420px;">
                <div class="row">
                    <div class="col-md-12">
                        <h2 style="text-align:center;padding:0;margin-bottom:4px;">NEW OKHLA INDUSTRIAL DEVELOPMENT AUTHORITY</h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h4 style="text-align:center;padding:0;margin-bottom:4px;">Jan Suvidha Kendra Sector-6 Administrator Office, NOIDA</h4>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-md-12">
                        <h5 style="text-align:center;padding:0;margin-top:4px;">Acknowledgement Receipt</h5>
                    </div>
                </div>
                <div class="row rw-pad">
                    <div class="col-md-12">
                        <span style="width:50%;text-align:right;float:right"> <b>Date: @DateTime.Now.ToString("dd-MMM-yyyy H:m:s")</b></span>
                    </div>
                </div>
                <div class="row rw-pad">
                    <div class="col-md-12">
                        <span style="width:50%;float:left"><b> Acknowledgement No: &nbsp;@Model.ServiceRequestId</b></span>
                        <span style="width:50%;text-align:right;float:right"><b> Registration No: &nbsp;@Model.Registration_No</b></span>
                    </div>
                </div>
                <div class="row rw-pad">
                    <div class="col-md-12">
                        <span style="width:50%;float:left"><b> Applicant Name: &nbsp;@Model.Name</b></span>
                        <span style="width:50%;text-align:right;float:right"><b>Property No: &nbsp;@Model.Property_No</b></span>
                    </div>
                </div>
                <div class="row rw-pad">
                    <div class="col-md-12">
                        <span style="width:50%;float:left"><b> Department: &nbsp;@Model.DepartmentName</b> &nbsp;&nbsp;( @Model.SubDepartment )</span>
                        <span style="width:50%;text-align:right;float:right"><b>Mobile No.: &nbsp;@Model.Mobile</b></span>
                    </div>
                </div>
                <div class="row rw-pad">
                    <div class="col-md-12">
                        @*<b> Service Name: &nbsp;@Model.ServiceName</b>*@
                        @{
                            if (Model.ServiceId != 21 || Model.ServiceId != 22)
                            {
                                <b> Service Name: &nbsp;@Model.ServiceName</b>
                            }
                            else
                            {
                                <b> Service Name: &nbsp;@Model.ServiceName</b> @Html.Raw("[") <label id="lblDescription">@Model.Description</label> @Html.Raw("]")
                            }
                        }
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12" style="text-align:justify;text-justify:inter-word">
                        <p>
                            <b> Note:</b> We will validate the information provided in application will be updated against the available information with the department.
                            In case where addition information like payment info addition supporting document etc.is required, the same shall be communicated on registered
                            mobile number and mail You can also track the status of service request on <b> http://www.mynoida.in </b>,Please keep your service request number for any
                            communication regarding the application.
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <b>
                            Thanks for using services online.<br />
                            Your Thankfully<br />
                            NOIDA
                        </b>
                    </div>
                </div>


            </div>
            <div style="page-break-after: always;"></div>
            <div class="modal-footer" style="text-align: center;">
                <button type="submit" id="btnPrintDiv" class="k-button" onclick="PrintDiv();">Print</button>
                <button type="submit" id="btnNext" class="k-button" data-dismiss="modal">Submit</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        if ('@ViewBag.uploadhtml' == "") {
            $(".btnName").attr("value", "Submit");
        }

        //$(".UploadDocuments").css("display", "none");
        $("#upload").click(function () {
            var files = $(".single");
            if ($(".single").length > 0) {
                var IsError = false;
                var strErrorMsg = "";

                var vtable = "<table style='text-align:left;padding:5px;width:100%;' ><thead><th style='text-align:left'>S No.</th><th style='text-align:left'>File Name</th><th style='text-align:left'>Description</th></thead><tbody>[trdata]<tr><td></td><td></td></tr></tbody></table>";

                for (i = 0; i < $(".single").length; i++) {
                    var FileNoCount = i + 1;
                    if ($(".single")[i].value.trim() != "") {

                        var size = ($(".single")[i].files[0].size / 1024);
                        var FileName = $(".single")[i].files[0].name;
                        var extension = $(".single")[i].value.substr(($(".single")[i].value.lastIndexOf('.') + 1));
                        if (extension.toLowerCase() == "pdf" || extension.toLowerCase() == "jpg" || extension.toLowerCase() == "jpeg") {

                        }
                        else {
                            IsError = true;
                            strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Unsupported format</label></td></tr>";
                        }

                        if (size < 10) {
                            IsError = true;
                            strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Min 10kb file size is allowed</label></td></tr>";
                        }

                        if (size / 1024 > 5) {
                            IsError = true;
                            strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Max 5Mb file size is allowed</label></td></tr>";
                        }
                    }
                    else {
                        IsError = true;
                        strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>No File Found</label></td><td><label>Please Upload the Document</label></td></tr>";
                    }
                }
                if (IsError) {
                    var tdata = vtable.replace('[trdata]', strErrorMsg);
                    alertify.alert("Upload Documents", tdata);
                    return false;
                }
            }
            else {
                if ($(".single").length == 0) {
                    return true;
                }
                else {
                    alertify.alert("Upload Documents", "No file found to upload.");
                    return false;
                }
            }
        });

    });

    var IsError = false;
    function CheckFileSize() {
        var reqID = $("#ServiceId").val();
        //$("#upload").click(function () {
        if (reqID <= 9 && reqID != 5) {
            var files = $(".single");
            if ($(".single").length > 0) {
                //var IsError = false;
                var strErrorMsg = "";

                // var vtable = "<table style='text-align:left;padding:5px;width:100%;' ><thead><th style='text-align:left'>S No.</th><th style='text-align:left'>File Name</th><th style='text-align:left'>Description</th></thead><tbody>[trdata]<tr><td></td><td></td></tr></tbody></table>";

                for (i = 0; i < $(".single").length; i++) {
                    var FileNoCount = i + 1;
                    if ($(".single")[i].value.trim() != "") {

                        var size = ($(".single")[i].files[0].size / 1024);
                        var FileName = $(".single")[i].files[0].name;
                        var extension = $(".single")[i].value.substr(($(".single")[i].value.lastIndexOf('.') + 1));
                        if (extension.toLowerCase() == "pdf" || extension.toLowerCase() == "jpg" || extension.toLowerCase() == "jpeg") {
                            IsError = true;
                        }
                        else {
                            IsError = false;
                            // strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Unsupported format</label></td></tr>";
                            alertify.error(FileNoCount + " " + FileName + " not allowed.");
                            return IsError;
                        }

                        if (size < 10) {
                            IsError = false;
                            //strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Min 10kb file size is allowed</label></td></tr>";
                            alertify.error(FileNoCount + " " + FileName + " Min 10kb file size is allowed");
                            return IsError;
                        }

                        if (size / 1024 > 5) {
                            IsError = false;
                            //strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>" + FileName + "</label></td><td><label>Max 5Mb file size is allowed</label></td></tr>";
                            alertify.error(FileNoCount + " " + FileName + " Max 5Mb file size is allowed");
                            return IsError;
                        }
                        //return IsError;
                    }
                    else {

                        IsError = false;
                        //strErrorMsg += "<tr><td><label>" + FileNoCount + "</label></td><td><label>No File Found</label></td><td><label>Please Upload the Document</label></td></tr>";
                        alertify.error("Please upload documents.");
                        return IsError;
                    }
                }
                //if (IsError) {
                //    var tdata = vtable.replace('[trdata]', strErrorMsg);
                //    alertify.alert("Upload Documents", tdata);
                //    return false;
                //}
            }
            else {
                if ($(".single").length == 0) {
                    return IsError = true;
                }
                else {
                    alertify.alert("Upload Documents", "No file found to upload.");
                    return IsError;
                }

            }
            return IsError;
            //});
        }
        else
            return true;
    }

    function ShowUploadDoc() {
        if ('@ViewBag.uploadhtml' != "") {
            $(".UploadDocuments").css("display", "block");
            $(".leftDiv").css("display", "none");
        }
        else {
            var registrationNo = $("#Registration_No").val();
            if (registrationNo != '') {
                window.location.href = "/Customer/ServiceRequest/" + '@NoidaAuthority.PMS.Common.Helpers.CommonHelper.Encode(Convert.ToString(Model.Registration_No))'; @*'@Url.Action("ServiceRequest/", "Customer", new { id = @ })'*@;
            }
        }
    }

    var flag = false;
    function CheckFileUpload() {
        var reqID = $("#ServiceId").val();
        if (reqID <= 9 && reqID != 5) {
            var files = $(".single");
            if ($(".single").length > 0) {
                for (i = 0; i < $(".single").length; i++) {
                    if ($(".single")[i].value.trim() == "") {
                        alertify.alert("Upload Documents", "Please Upload All the Documents");
                        return flag = false;
                    }
                    else {
                        flag = true;
                    }
                }
                return flag;
            }
            else {
                if ($(".single").length == 0) {
                    return flag = true;
                }
                else {
                    alertify.alert("Upload Documents", "No file found to upload.");
                    return flag = false;
                }
            }
        }
        else
            return flag = true;
    }


    function PrintDiv() {
        var contents = document.getElementById("divAcknowledgementReceiptBody").innerHTML;
        var frame1 = document.createElement('iframe');
        frame1.name = "frame1";
        frame1.style.position = "absolute";
        frame1.style.top = "-1000000px";
        document.body.appendChild(frame1);
        var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1.contentDocument.document : frame1.contentDocument;
        frameDoc.document.open();
        frameDoc.document.write('<html><head><title></title>');
        frameDoc.document.write('</head><body>');
        frameDoc.document.write(contents);
        frameDoc.document.write('</body></html>');
        frameDoc.document.close();
        setTimeout(function () {
            window.frames["frame1"].focus();
            window.frames["frame1"].print();
            document.body.removeChild(frame1);
        }, 500);
        return false;
    }

    var popupFlag = false;
    function SubmitFormData() {
        return popupFlag;
    }

    $('#btnNext').click(function () {
        $('#userform').submit();
        //popupFlag = true;
        //SubmitFormData();
        //$('#popupValue').val("true");
    });

</script>